"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}();!function t($,i,e,s){function n(t,i){var e=void 0;return $.data(t[0],"plugin_"+a)?e=$.data(t[0],"plugin_"+a):(e=new g(t,i),$.data(t[0],"plugin_"+a,e)),e}var a="slotMachine",r={active:0,delay:100,auto:!1,spins:5,randomize:null,complete:null,stopHidden:!0,direction:"up"},h="slotMachineNoTransition",o="slotMachineBlurFast",l="slotMachineBlurMedium",u="slotMachineBlurSlow",c="slotMachineBlurTurtle",f="slotMachineGradient",d="slotMachineGradient",v=function(){function t(i,e){return _classCallCheck(this,t),this.cb=i,this.initialDelay=e,this.delay=e,this.deferred=jQuery.Deferred(),this.startTime=null,this.timer=null,this.running=!1,this.resume(),this}return _createClass(t,[{key:"_start",value:function t(){this.timer=setTimeout(function t(){this.cb.call(this)}.bind(this),this.delay)}},{key:"cancel",value:function t(){this.running=!1,clearTimeout(this.timer)}},{key:"pause",value:function t(){this.running&&(this.delay-=(new Date).getTime()-this.startTime,this.cancel())}},{key:"resume",value:function t(){this.running||(this.running=!0,this.startTime=(new Date).getTime(),this._start())}},{key:"reset",value:function t(){this.cancel(),this.delay=this.initialDelay,this._start()}},{key:"add",value:function t(i){this.pause(),this.delay+=i,this.resume()}}]),t}(),g=function(){function t(i,e){_classCallCheck(this,t),this.element=i,this.settings=$.extend({},r,e),this.defaults=r,this.name=a,this.$slot=$(i),this.$tiles=this.$slot.children(),this.$container=null,this._minTop=null,this._maxTop=null,this._$fakeFirstTile=null,this._$fakeLastTile=null,this._timer=null,this._spinsLeft=null,this.futureActive=null,this.running=!1,this.stopping=!1,this.active=this.settings.active,this.$slot.css("overflow","hidden"),this.$container=this.$tiles.wrapAll('<div class="slotMachineContainer" />').parent(),this.$container.css("transition","1s ease-in-out"),this._maxTop=-this.$container.height(),this._initFakeTiles(),this._minTop=-this._$fakeFirstTile.outerHeight(),this._initDirection(),this.resetPosition(),!1!==this.settings.auto&&(!0===this.settings.auto?this.shuffle():this.auto())}return _createClass(t,[{key:"_initFakeTiles",value:function t(){this._$fakeFirstTile=this.$tiles.last().clone(),this._$fakeLastTile=this.$tiles.first().clone(),this.$container.prepend(this._$fakeFirstTile),this.$container.append(this._$fakeLastTile)}},{key:"_initDirection",value:function t(){this._direction={selected:"down"===this.settings.direction?"down":"up",up:{key:"up",initial:this.getTileOffset(this.active),first:0,last:this.getTileOffset(this.$tiles.length),to:this._maxTop,firstToLast:this.getTileOffset(this.$tiles.length),lastToFirst:0},down:{key:"down",initial:this.getTileOffset(this.active),first:this.getTileOffset(this.$tiles.length),last:0,to:this._minTop,firstToLast:this.getTileOffset(this.$tiles.length),lastToFirst:0}}}},{key:"_changeTransition",value:function t(){var i=this._delay||this.settings.delay,e=this._transition||this.settings.transition;this.$container.css("transition",i+"s "+e)}},{key:"_animate",value:function t(i){this.$container.css("transform","matrix(1, 0, 0, 1, 0, "+i+")")}},{key:"_isGoingBackward",value:function t(){return this.futureActive>this.active&&0===this.active&&this.futureActive===this.$tiles.length-1}},{key:"_isGoingForward",value:function t(){return this.futureActive<=this.active&&this.active===this.$tiles.length-1&&0===this.futureActive}},{key:"raf",value:function t(e,s){var n=i.requestAnimationFrame||i.mozRequestAnimationFrame||i.webkitRequestAnimationFrame||i.msRequestAnimationFrame,a=(new Date).getTime();n(function t(){(new Date).getTime()-a<s?n(t):"function"==typeof e&&e()})}},{key:"getTileOffset",value:function t(i){for(var e=0,s=0;s<i;s++)e+=this.$tiles.eq(s).outerHeight();return this._minTop-e}},{key:"resetPosition",value:function t(i){this.$container.toggleClass("slotMachineNoTransition"),this._animate(i===s?this.direction.initial:i),this.$container[0].offsetHeight,this.$container.toggleClass("slotMachineNoTransition")}},{key:"setRandomize",value:function t(i){this.settings.randomize=i,"number"==typeof i&&(this.settings.randomize=function(){return i})}},{key:"prev",value:function t(){return this.futureActive=this.prevIndex,this.running=!0,this.stop(),this.futureActive}},{key:"next",value:function t(){return this.futureActive=this.nextIndex,this.running=!0,this.stop(),this.futureActive}},{key:"getDelayFromSpins",value:function t(i){var e=this.settings.delay;switch(this._transition="linear",i){case 1:e/=.5,this._transition="ease-out",this._animationFX="slotMachineBlurTurtle";break;case 2:e/=.75,this._animationFX="slotMachineBlurSlow";break;case 3:e/=1,this._animationFX=l;break;case 4:e/=1.25,this._animationFX=l;break;default:e/=1.5,this._animationFX="slotMachineBlurFast"}return e}},{key:"shuffle",value:function t(i,e){var s=this;if("function"==typeof i&&(e=i),this.running=!0,this.visible||!0!==this.settings.stopHidden){var n=this.getDelayFromSpins(i);this.delay=n,this._animate(this.direction.to),this.raf(function(){if(!s.stopping&&s.running){var t=i-1;s.resetPosition(s.direction.first),t<=1?s.stop(e):s.shuffle(t,e)}},n)}else this.stop(e);return this.futureActive}},{key:"stop",value:function t(i){var e=this;if(!this.running||this.stopping)return this.futureActive;this.running=!0,this.stopping=!0,null===this.futureActive&&(this.futureActive=this.custom),this._isGoingBackward()?this.resetPosition(this.direction.firstToLast):this._isGoingForward()&&this.resetPosition(this.direction.lastToFirst),this.active=this.futureActive;var s=this.getDelayFromSpins(1);return this.delay=s,this._animationFX=f,this._animate(this.getTileOffset(this.active)),this.raf(function(){e.stopping=!1,e.running=!1,e.futureActive=null,"function"==typeof e.settings.complete&&e.settings.complete.apply(e,[e.active]),"function"==typeof i&&i.apply(e,[e.active])},s),this.active}},{key:"auto",value:function t(){var i=this;this.running||(this._timer=new v(function(){"function"!=typeof i.settings.randomize&&(i.settings.randomize=function(){return i._nextIndex}),i.visible||!0!==i.settings.stopHidden?i.shuffle(i.settings.spins,i._timer.reset.bind(i._timer)):i.raf(i._timer.reset.bind(i._timer),500)},this.settings.auto))}},{key:"destroy",value:function t(){this._$fakeFirstTile.remove(),this._$fakeLastTile.remove(),this.$tiles.unwrap(),$.data(this.element[0],"plugin_"+a,null)}},{key:"active",get:function t(){return this._active},set:function t(i){this._active=i,(i<0||i>=this.$tiles.length)&&(this._active=0)}},{key:"visibleTile",get:function t(){var i=this.$tiles.first().height(),e=this.$container.css("transform"),s=/^matrix\(-?\d+,\s?-?\d+,\s?-?\d+,\s?-?\d+,\s?-?\d+,\s?(-?\d+)\)$/,n=parseInt(e.replace(/^matrix\(-?\d+,\s?-?\d+,\s?-?\d+,\s?-?\d+,\s?-?\d+,\s?(-?\d+)\)$/,"$1"),10);return Math.abs(Math.round(n/i))-1}},{key:"random",get:function t(){return Math.floor(Math.random()*this.$tiles.length)}},{key:"custom",get:function t(){var i=void 0;if("function"==typeof this.settings.randomize){var e=this.settings.randomize.call(this,this.active);(e<0||e>=this.$tiles.length)&&(e=0),i=e}else i=this.random;return i}},{key:"direction",get:function t(){return this._direction[this._direction.selected]},set:function t(i){this.running||(this.direction="down"===i?"down":"up")}},{key:"_prevIndex",get:function t(){var i=this.active-1;return i<0?this.$tiles.length-1:i}},{key:"_nextIndex",get:function t(){var i=this.active+1;return i<this.$tiles.length?i:0}},{key:"prevIndex",get:function t(){return"up"===this.direction?this._nextIndex:this._prevIndex}},{key:"nextIndex",get:function t(){return"up"===this.direction?this._prevIndex:this._nextIndex}},{key:"visible",get:function t(){var e=$(i),s=this.$slot.offset().top>e.scrollTop()+e.height(),n=e.scrollTop()>this.$slot.height()+this.$slot.offset().top;return!s&&!n}},{key:"_fxClass",set:function t(i){var e=["slotMachineBlurFast",l,"slotMachineBlurSlow","slotMachineBlurTurtle"].join(" ");this.$tiles.add(this._$fakeFirstTile).add(this._$fakeLastTile).removeClass(e).addClass(i)}},{key:"_animationFX",set:function t(i){var e=this.settings.delay/4,s=this.$slot.add(this.$tiles).add(this._$fakeFirstTile).add(this._$fakeLastTile);this.raf(function t(){this._fxClass=i,i===f?s.removeClass("slotMachineGradient"):s.addClass("slotMachineGradient")}.bind(this),e)}},{key:"delay",set:function t(i){i/=1e3,this._delay=i,this._changeTransition()}},{key:"transition",set:function t(i){i=i||"ease-in-out",this._transition=i,this._changeTransition()}}]),t}();$.fn[a]=function t(i){var e=this,s=void 0;return 1===this.length?s=n(this,i):function(){var t=e;s=$.map(t,function(e,s){return n(t.eq(s),i)})}(),s}}(jQuery,window,document);